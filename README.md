# ğŸ¥ Medical AI Gateway 2.0 - Hospital Edition

> **Transforming Handwritten Prescriptions into Intelligent, Time-Aware Clinical Intelligence**

A production-ready medical document processing system that digitizes prescriptions, builds comprehensive patient timelines, and provides explainable AI-driven insights for better clinical decisions.

---

## ğŸ¯ What Makes Us Different

| ğŸŒŸ Feature | Description |
|------------|-------------|
| **ğŸ“Š Longitudinal Patient Timeline** | Complete visual history of every prescription, medication change, and treatment across time |
| **ğŸ§  Explainable AI** | Every AI recommendation comes with clear reasoning - doctors know *why* not just *what* |
| **ğŸ“‹ Whole Patient Data** | 360Â° view of patient: medications, conditions, allergies, vitals, symptoms - all in one place |
| **â±ï¸ Temporal Intelligence** | Understands medication overlaps, gaps, dose changes, and treatment patterns over time |

---

## ğŸ”„ Complete System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MEDICAL AI GATEWAY - END TO END FLOW                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“„ PRESCRIPTION                ğŸ‘¨â€ğŸ’¼ STAFF                   ğŸ¤– AI ENGINE                  ğŸ‘¨â€âš•ï¸ DOCTOR
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€
       â”‚                             â”‚                           â”‚                            â”‚
       â”‚   Handwritten/Printed       â”‚                           â”‚                            â”‚
       â”‚   Prescription arrives      â”‚                           â”‚                            â”‚
       â–¼                             â–¼                           â”‚                            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚                            â”‚
  â”‚  Scan/  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Staff Portalâ”‚                   â”‚                            â”‚
  â”‚ Upload  â”‚                  â”‚   Upload    â”‚                   â”‚                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚                            â”‚
                                      â”‚                          â”‚                            â”‚
                                      â–¼                          â–¼                            â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                               â”‚ Patient Reg/ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  OCR Engine â”‚                     â”‚
                               â”‚ QR Generationâ”‚           â”‚  (Vision AI)â”‚                     â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                                 â”‚                            â”‚
                                                                 â–¼                            â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                                                          â”‚    Text     â”‚                     â”‚
                                                          â”‚  Cleaning   â”‚                     â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                                 â”‚                            â”‚
                                                                 â–¼                            â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                                                          â”‚   Entity    â”‚                     â”‚
                                                          â”‚ Extraction  â”‚                     â”‚
                                                          â”‚  (Gemini)   â”‚                     â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                                 â”‚                            â”‚
                                                                 â–¼                            â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                                                          â”‚    Drug     â”‚                     â”‚
                                                          â”‚Normalizationâ”‚                     â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                                 â”‚                            â”‚
                                                                 â–¼                            â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                                                          â”‚   Safety    â”‚                     â”‚
                                                          â”‚  Analysis   â”‚                     â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                                 â”‚                            â”‚
                                                                 â–¼                            â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                                                          â”‚  Timeline   â”‚                     â”‚
                                                          â”‚  Building   â”‚                     â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                                 â”‚                            â”‚
                                                                 â–¼                            â–¼
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”‚ Structured  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Doctor    â”‚
                                                          â”‚    Data     â”‚           â”‚  Dashboard  â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¥ Role-Based Workflow

### ğŸ‘¨â€ğŸ’¼ What Staff Does

| Step | Action | Outcome |
|------|--------|---------|
| 1ï¸âƒ£ | **Register New Patient** | Enter demographics, allergies, existing conditions, emergency contact |
| 2ï¸âƒ£ | **Scan/Upload Prescription** | Drag & drop or upload prescription images (supports multiple at once) |
| 3ï¸âƒ£ | **Generate QR Code** | Unique patient QR code created automatically |
| 4ï¸âƒ£ | **Add Future Prescriptions** | Scan QR or enter UID to add new prescriptions to existing patient |

> **Staff Portal Location:** `/staff`

---

### ğŸ¤– What AI Does (Behind the Scenes)

| Stage | AI Action | Technology |
|-------|-----------|------------|
| **OCR** | Digitizes handwritten/printed prescriptions | Google Cloud Vision |
| **Text Cleaning** | Fixes OCR errors, expands abbreviations (qdâ†’once daily) | Medical Dictionary |
| **Entity Extraction** | Extracts patient info, doctor info, medications, diagnosis, vitals | Google Gemini AI |
| **Drug Normalization** | Maps brand names to generics (Lipitorâ†’Atorvastatin) | Drug Database |
| **Safety Analysis** | Checks drug interactions, allergies, contraindications | Safety Engine |
| **Timeline Building** | Creates temporal medication history with change detection | Temporal Reasoner |
| **Explainability** | Generates human-readable explanations for all AI decisions | Explainability Engine |

---

### ğŸ‘¨â€âš•ï¸ What Doctors Get

| Benefit | Description |
|---------|-------------|
| **ğŸ“Š Complete Timeline View** | Visual timeline showing every medication prescribed across all visits |
| **ğŸ”„ Medication Change Tracking** | See what was started, stopped, or dose-changed over time |
| **âš ï¸ Safety Alerts** | Instant warnings for drug interactions, allergies, contraindications |
| **ğŸ’¡ Explainable Insights** | Every AI recommendation includes clear reasoning |
| **ğŸ” Quick Patient Lookup** | Scan QR code or enter UID for instant access |
| **ğŸ’¬ AI Assistant** | Ask natural language questions about the patient |
| **ğŸ“ˆ Longitudinal Analysis** | Understand treatment patterns over weeks, months, years |
| **ğŸ©º Active Medications** | Current medication list with dosages at a glance |

> **Doctor Dashboard Location:** `/` (Home)

---

## â­ Core Features Explained

### 1. ğŸ“Š Longitudinal Patient Timeline

The heart of our system - a **complete temporal view** of patient's medical journey:

```
PATIENT TIMELINE EXAMPLE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Jan 2024     â”‚ Feb 2024      â”‚ Mar 2024       â”‚ Apr 2024       â”‚ May 2024
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Metformin    â”‚ Metformin     â”‚ Metformin      â”‚ Metformin      â”‚ Metformin
500mg BD     â”‚ 500mg BD      â”‚ â¬†ï¸ 1000mg BD   â”‚ 1000mg BD      â”‚ 1000mg BD
             â”‚               â”‚                â”‚                â”‚
             â”‚ +Lisinopril   â”‚ Lisinopril     â”‚ Lisinopril     â”‚ Lisinopril
             â”‚ 5mg OD        â”‚ 5mg OD         â”‚ â¬†ï¸ 10mg OD     â”‚ 10mg OD
             â”‚               â”‚                â”‚                â”‚
             â”‚               â”‚ +Atorvastatin  â”‚ Atorvastatin   â”‚ Atorvastatin
             â”‚               â”‚ 10mg OD        â”‚ 10mg OD        â”‚ 10mg OD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

**What it tracks:**
- âœ… Medication starts and stops
- âœ… Dose changes over time
- âœ… Overlapping medications
- âœ… Treatment gaps
- âœ… Visit-by-visit changes

---

### 2. ğŸ§  Explainable AI

Every AI decision comes with **transparent reasoning**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ DRUG INTERACTION ALERT                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Warfarin + Aspirin detected                                         â”‚
â”‚                                                                     â”‚
â”‚ ğŸ” EXPLANATION:                                                     â”‚
â”‚ â€¢ Both medications affect blood clotting                            â”‚
â”‚ â€¢ Combined use increases bleeding risk by 40%                       â”‚
â”‚ â€¢ Source: FDA Drug Interaction Database                             â”‚
â”‚ â€¢ Confidence: 95%                                                   â”‚
â”‚                                                                     â”‚
â”‚ ğŸ’¡ RECOMMENDATION:                                                  â”‚
â”‚ Consider lower aspirin dose or alternative antiplatelet therapy     â”‚
â”‚                                                                     â”‚
â”‚ ğŸ“Š EVIDENCE:                                                        â”‚
â”‚ Based on patient's current medications and known interactions       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why explainability matters:**
- Doctors understand the *reasoning* behind alerts
- Builds trust in AI recommendations
- Supports informed clinical decisions
- Reduces alert fatigue with context

---

### 3. ğŸ“‹ Whole Patient Data (360Â° View)

Everything about the patient in one unified view:

| Data Category | What's Captured |
|---------------|-----------------|
| **Demographics** | Name, Age, Gender, Phone, Address, Emergency Contact |
| **Medical History** | Chronic conditions, past surgeries, hospitalizations |
| **Allergies** | Drug allergies, food allergies, environmental |
| **Current Medications** | Active drugs with dosage, frequency, duration |
| **Past Medications** | Complete prescription history with dates |
| **Vitals History** | BP, Pulse, Temperature, Weight, SpO2 over time |
| **Symptoms** | Current and historical symptom records |
| **Diagnosis** | ICD-10 compatible condition tracking |
| **Lab Results** | Integration-ready for lab data |

---

### 4. â±ï¸ Temporal Intelligence

Our AI understands **time** in medical context:

| Capability | Description |
|------------|-------------|
| **Change Detection** | Automatically identifies when medications were started, stopped, or changed |
| **Overlap Analysis** | Detects when multiple prescriptions have overlapping medications |
| **Gap Identification** | Flags treatment gaps or missed refills |
| **Pattern Recognition** | Identifies recurring prescription patterns |
| **Visit Comparison** | Compares what changed between consecutive visits |

---

## ğŸ”’ Safety & Compliance

| Feature | Description |
|---------|-------------|
| **Drug-Drug Interactions** | 30+ specific interaction pairs monitored |
| **Allergy Checking** | Cross-references every prescription with patient allergies |
| **Contraindications** | Medication vs condition conflict detection |
| **Duplicate Therapy** | Alerts for same therapeutic class |
| **HIPAA Compliance** | Complete audit logging of all actions |
| **Audit Trail** | Every action tracked for compliance reporting |

---

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Staff Portal          â”‚         Doctor Dashboard            â”‚
â”‚    (Patient Registration)  â”‚    (Patient Lookup & Analysis)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API LAYER                               â”‚
â”‚    FastAPI with REST endpoints for all operations                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AI SERVICES LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OCR Service â”‚ AI Extractor â”‚ Drug Safety  â”‚ Timeline Builder   â”‚
â”‚ (Cloud Vision)â”‚  (Gemini)   â”‚   Engine     â”‚ (Temporal Reasoning)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATA LAYER                                 â”‚
â”‚   Patient Database â”‚ Prescription Store â”‚ Audit Logs             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Key Benefits Summary

| For Staff | For AI | For Doctors |
|-----------|--------|-------------|
| âœ… Easy patient registration | âœ… Accurate OCR processing | âœ… Complete patient timeline |
| âœ… Simple prescription upload | âœ… Intelligent entity extraction | âœ… Explainable recommendations |
| âœ… QR code for quick lookup | âœ… Drug normalization | âœ… Safety alerts with context |
| âœ… Batch processing support | âœ… Automated safety checks | âœ… 360Â° patient view |
| âœ… Minimal training needed | âœ… Temporal analysis | âœ… AI-powered Q&A assistant |

---

## ğŸš€ Quick Start

### Prerequisites
- Python 3.9+
- Google Cloud Vision API credentials

### Installation

```bash
# Clone the repository
cd "D:\Hackathon\OCR AIT"

# Create virtual environment
python -m venv .venv
.\.venv\Scripts\Activate.ps1  # Windows
# source .venv/bin/activate   # Linux/Mac

# Install dependencies
pip install -r requirements.txt

# Set up Google Cloud credentials
# Place your service account JSON file as: kg-hackathon-e3f03b59d928.json
```

### Running the Application

```bash
# Start the server
python main.py

# Or with uvicorn directly
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### Access the Application
| URL | Description |
|-----|-------------|
| http://localhost:8000 | Doctor Dashboard |
| http://localhost:8000/staff | Staff Portal |
| http://localhost:8000/api/docs | API Documentation (Swagger) |
| http://localhost:8000/api/redoc | API Documentation (ReDoc) |

---

## ğŸ“š API Endpoints

### Staff API (`/api/staff/`)
| Endpoint | Method | Description |
|----------|--------|-------------|
| `/create-patient` | POST | Register new patient with prescription |
| `/patient/{uid}` | GET | Get patient by UID |
| `/patient/{uid}/full-details` | GET | Complete patient data for doctors |
| `/patient/{uid}/ai-context` | GET | AI-optimized patient data |
| `/patient/{uid}/prescriptions` | GET | All patient prescriptions |
| `/patient/{uid}/timeline` | GET | Medication timeline |
| `/add-prescription` | POST | Add single prescription |
| `/add-prescriptions` | POST | Add multiple prescriptions |
| `/decode-qr` | POST | Decode QR code image |
| `/doctor/scan-qr` | POST | Doctor scans QR â†’ full details |
| `/patients` | GET | List all patients |

### Documents API (`/api/documents/`)
| Endpoint | Method | Description |
|----------|--------|-------------|
| `/upload` | POST | Upload and process a document |
| `/process-text` | POST | Process raw text |
| `/{id}` | GET | Get processed document |
| `/{id}/correct` | POST | Submit correction |

### Patients API (`/api/patients/`)
| Endpoint | Method | Description |
|----------|--------|-------------|
| `/` | POST | Create patient |
| `/{id}` | GET | Get patient info |
| `/{id}/medications` | GET | Get medications |
| `/{id}/medications` | POST | Add medication |
| `/{id}/interactions` | GET | Check drug interactions |
| `/{id}/timeline` | GET | Get medical timeline |
| `/{id}/graph` | GET | Get knowledge graph |

### Query API (`/api/query/`)
| Endpoint | Method | Description |
|----------|--------|-------------|
| `/` | GET | Ask medical questions |
| `/chat` | POST | Chat interface |
| `/suggestions` | GET | Get query suggestions |

### Analytics API (`/api/analytics/`)
| Endpoint | Method | Description |
|----------|--------|-------------|
| `/dashboard` | GET | Dashboard statistics |
| `/medications/frequency` | GET | Medication distribution |
| `/interactions/summary` | GET | Interaction summary |

---

## ğŸ—ï¸ Architecture

```
medical-ai-gateway/
â”œâ”€â”€ main.py                     # FastAPI application entry point
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ Dockerfile                  # Container build
â”œâ”€â”€ docker-compose.yml          # Multi-container orchestration
â”œâ”€â”€ init-db.sql                 # Database schema
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ config.py               # Application configuration
â”‚   â”œâ”€â”€ database/               # Database connection & models
â”‚   â”‚   â”œâ”€â”€ connection.py
â”‚   â”‚   â””â”€â”€ models.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ patient.py
â”‚   â”‚   â”œâ”€â”€ document.py
â”‚   â”‚   â”œâ”€â”€ prescription.py
â”‚   â”‚   â”œâ”€â”€ medication.py
â”‚   â”‚   â”œâ”€â”€ knowledge_graph.py
â”‚   â”‚   â”œâ”€â”€ medical_entity.py
â”‚   â”‚   â”œâ”€â”€ audit.py
â”‚   â”‚   â””â”€â”€ timeline.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # Business logic
â”‚   â”‚   â”œâ”€â”€ ocr_service.py              # Google Vision OCR
â”‚   â”‚   â”œâ”€â”€ text_cleaning_service.py    # OCR text cleanup
â”‚   â”‚   â”œâ”€â”€ entity_extraction_service.py # Extract medical entities
â”‚   â”‚   â”œâ”€â”€ drug_normalization_service.py # Brand â†’ Generic
â”‚   â”‚   â”œâ”€â”€ drug_interaction_service.py  # Safety checks
â”‚   â”‚   â”œâ”€â”€ prescription_structuring_service.py
â”‚   â”‚   â”œâ”€â”€ temporal_reasoning_service.py # Timeline analysis
â”‚   â”‚   â”œâ”€â”€ knowledge_graph_service.py   # Entity relationships
â”‚   â”‚   â”œâ”€â”€ patient_history_service.py   # Longitudinal tracking
â”‚   â”‚   â”œâ”€â”€ unified_patient_service.py   # Patient CRUD
â”‚   â”‚   â”œâ”€â”€ medical_ai_assistant.py      # AI queries
â”‚   â”‚   â”œâ”€â”€ gemini_service.py            # Gemini AI integration
â”‚   â”‚   â”œâ”€â”€ audit_service.py             # Action logging
â”‚   â”‚   â”œâ”€â”€ human_review_service.py      # Review queue
â”‚   â”‚   â”œâ”€â”€ uncertainty_service.py       # Confidence scoring
â”‚   â”‚   â””â”€â”€ complete_processor.py        # Full pipeline
â”‚   â”‚
â”‚   â””â”€â”€ api/                    # API routes
â”‚       â”œâ”€â”€ documents.py
â”‚       â”œâ”€â”€ patients.py
â”‚       â”œâ”€â”€ staff_api.py        # Staff portal endpoints
â”‚       â”œâ”€â”€ query.py
â”‚       â””â”€â”€ analytics.py
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html              # Landing page
â”‚   â”œâ”€â”€ dashboard.html          # Doctor dashboard
â”‚   â””â”€â”€ staff.html              # Staff portal
â”‚
â””â”€â”€ data/                       # Data storage
    â”œâ”€â”€ uploads/                # Uploaded documents
    â”œâ”€â”€ processed/              # Processed results
    â””â”€â”€ audit_logs/             # Audit logs
```

---

## ğŸ”§ Configuration

Environment variables (or `.env` file):

```env
# Database
DATABASE_URL=sqlite:///./data/medical_gateway.db

# Google Cloud Vision OCR
GOOGLE_CREDENTIALS_PATH=kg-hackathon-e3f03b59d928.json

# Optional: Neo4j for Knowledge Graph
USE_NEO4J=false
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password

# Optional: LLM Integration
USE_LLM=false
OPENAI_API_KEY=your-key-here
```

---

## ğŸ“‹ Example Usage

### Staff Portal: Register New Patient

```python
import requests

# Create patient with prescription
files = {'file': open('prescription.pdf', 'rb')}
data = {
    'first_name': 'John',
    'last_name': 'Doe',
    'age': 45,
    'gender': 'Male',
    'phone': '9876543210',
    'allergies': 'Penicillin,Sulfa',
    'conditions': 'Diabetes,Hypertension'
}

response = requests.post(
    'http://localhost:8000/api/staff/create-patient',
    files=files,
    data=data
)

result = response.json()
print(f"Patient UID: {result['patient']['uid']}")
print(f"QR Code: Generated for quick lookup")
```

### Doctor: Lookup Patient by UID

```python
# Get complete patient details
response = requests.get(
    'http://localhost:8000/api/staff/patient/PT20260130-A1B2/full-details'
)

patient = response.json()
print(f"Name: {patient['patient']['name']}")
print(f"Allergies: {patient['patient']['allergies']}")
print(f"Active Medications: {patient['active_medications']}")
print(f"Prescription Count: {patient['summary']['total_prescriptions']}")
```

### Check Drug Interactions

```python
# Add medications and check interactions
requests.post(
    'http://localhost:8000/api/patients/P001/medications',
    params={'medication_name': 'Warfarin', 'dosage': '5mg'}
)

requests.post(
    'http://localhost:8000/api/patients/P001/medications',
    params={'medication_name': 'Aspirin', 'dosage': '325mg'}
)

# Check interactions
response = requests.get('http://localhost:8000/api/patients/P001/interactions')
interactions = response.json()
# Will detect Warfarin + Aspirin interaction (increased bleeding risk)
```

### AI Assistant Query

```python
# Get AI context for patient
response = requests.get(
    'http://localhost:8000/api/staff/patient/PT20260130-A1B2/ai-context'
)

context = response.json()['ai_context']
print(f"Summary: {context['summary_text']}")
# "Patient John Doe, 45 years old, Male. Known allergies: Penicillin, Sulfa. 
#  Chronic conditions: Diabetes, Hypertension. Currently taking: Metformin 500mg, 
#  Lisinopril 10mg. Total prescriptions on record: 5."
```

---

## ğŸ³ Docker Deployment

```bash
# Build and run with Docker Compose
docker-compose up --build

# Or build manually
docker build -t medai-gateway .
docker run -p 8000:8000 medai-gateway
```

---

## ğŸ“¦ Key Dependencies

| Package | Purpose |
|---------|---------|
| `fastapi` | Web framework |
| `uvicorn` | ASGI server |
| `sqlalchemy` | ORM |
| `google-cloud-vision` | OCR |
| `pyzbar` | QR code decoding |
| `opencv-python` | Image processing |
| `python-multipart` | File uploads |
| `qrcode` | QR code generation |

---

## ğŸ”’ Security Features

- âœ… **JWT Authentication** - Secure token-based login
- âœ… **Role-Based Access Control** - Admin, Doctor, Pharmacist, Nurse, Receptionist
- âœ… **HIPAA-Compliant Audit Logging** - Complete action tracking
- âœ… **Password Hashing** - bcrypt with salt
- âœ… **Session Management** - Token expiration & refresh

---

## ğŸ’¡ Why Choose Medical AI Gateway?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ğŸ“„ Messy Prescription  âœ  ğŸ¤– AI Processing  âœ  ğŸ“Š Actionable Intelligence â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Staff uploads in seconds                                                â”‚
â”‚   â€¢ AI extracts, normalizes, and analyzes automatically                     â”‚
â”‚   â€¢ Doctors get complete, explainable, time-aware patient insights          â”‚
â”‚                                                                             â”‚
â”‚   âœ¨ Result: Better clinical decisions, faster patient care                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“„ License

This project is for educational/hackathon purposes.

---

## ğŸ™ Acknowledgments

- Google Cloud Vision API for OCR
- Google Gemini AI for intelligent entity extraction
- FastAPI for the high-performance web framework

---

**Made with â¤ï¸ for Healthcare | Transforming Prescriptions into Intelligence**
